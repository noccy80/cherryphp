#!/usr/bin/php
<?php

// Bootstrap
if (!( @include_once "lib/bootstrap.php" )) {
    $libpath = getenv('CHERRY_LIB');
    if (!$libpath) {
        fprintf(STDERR,"Define the CHERRY_LIB envvar first.");
        exit(1);
    }
    require_once($libpath.'/lib/bootstrap.php');
}

$lepton = new \cherry\Lepton(__FILE__);

// We need this to set up a CLI application
require_once('lib/cherry/cli/application.php');

use cherry\base\Event;
use cherry\base\EventEmitter;

require_once('lib/cherry/net/socketserver.php');
$ss = new \cherry\net\SocketServer(6667);
$ss->on('connection', function($ip,$port) {
    printf("Creating new SocketSession for %s:%d\n", $ip, $port);
    $socksess = new \cherry\net\SocketSession();
    $socksess->setTransport(new \cherry\net\socket\transport\HttpTransport());
});
$ss->on('ready', function() {
    printf("Server is ready.\n");
});
$ss->start();

class q {
    function m($name) { echo "Awesome, $name!\n"; }
}

use \cherry\base\Callable;
$cb = new Callable(function($name){ echo "Hello, $name\n"; });
$cb('World');
$cb = new Callable('q','m');
$cb('World');
